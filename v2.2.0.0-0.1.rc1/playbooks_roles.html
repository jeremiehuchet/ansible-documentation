

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Tag Manager Data Layer -->
  <script>
   dataLayer = [];
  </script>
  <!-- End Google Tag Manager Data Layer -->

  
  <title>Playbook Roles and Include Statements &mdash; Ansible v2.2.0.0-0.1.rc1 Documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'./',
        VERSION:'2.1',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  false
      };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.min.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
    <link rel="top" title="Ansible v2.2.0.0-0.1.rc1 Documentation" href="index.html"/>
        <link rel="up" title="Playbooks" href="playbooks.html"/>
        <link rel="next" title="Variables" href="playbooks_variables.html"/>
        <link rel="prev" title="Intro to Playbooks" href="playbooks_intro.html"/> 

  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

  <style>
    .search-reset-start {
        color: #463E3F;
        float: right;
        position: relative;
        top: -25px;
        left: -10px;
        z-index: 10;
     }
     .search-reset-start:hover {
        cursor: pointer;
        color: #2980B9;
     }
     #search-box-id {
        padding-right: 25px;
     }
  </style>

  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300'
    rel='stylesheet' type='text/css'>

</head>

<body class="wy-body-for-nav">

  <!-- Google Tag Manager -->
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PSB293" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-PSB293');</script>
  <!-- End Google Tag Manager -->

  <a class="DocSite-nav" href="http://docs.ansible.com/">
    <img class="DocSiteNav-logo"
      src="_static/images/logo_invert.png"
      alt="Ansible Logo">
    <div class="DocSiteNav-title">
      Documentation v2.2.0.0-0.1.rc1
    </div>
  </a>

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">

      <div style="background-color:#5bbdbf;height=80px;margin:'auto auto auto auto'">
        <a class="DocSiteProduct-header DocSiteProduct-header--core"
          href="http://docs.ansible.com/ansible/">
          <div class="DocSiteProduct-productName">
            <div class="DocSiteProduct-logoText">
              ANSIBLE
            </div>
          </div>
        </a>
      </div>

      <div id="menu-id" class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro_installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_getting_started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_inventory.html">Inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_dynamic_inventory.html">Dynamic Inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_patterns.html">Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_adhoc.html">Introduction To Ad-Hoc Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_configuration.html">Configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_bsd.html">BSD Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_windows.html">Windows Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_networking.html">Networking Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart Video</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="playbooks.html">Playbooks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="playbooks_intro.html">Intro to Playbooks</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Playbook Roles and Include Statements</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_variables.html">Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_filters.html">Jinja2 filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_tests.html">Jinja2 tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_conditionals.html">Conditionals</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_loops.html">Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_blocks.html">Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_strategies.html">Strategies</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_best_practices.html">Best Practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="playbooks_special_topics.html">Playbooks: Special Topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="become.html">Become (Privilege Escalation)</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_acceleration.html">Accelerated Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_async.html">Asynchronous Actions and Polling</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_checkmode.html">Check Mode (&#8220;Dry Run&#8221;)</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_debugger.html">Playbook Debugger</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_delegation.html">Delegation, Rolling Updates, and Local Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_environment.html">Setting the Environment (and Working With Proxies)</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_error_handling.html">Error Handling In Playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_advanced_syntax.html">Advanced Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_lookups.html">Using Lookups</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_prompts.html">Prompts</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_tags.html">Tags</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_vault.html">Vault</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_startnstep.html">Start and Step</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">About Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="modules_intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules_core.html">Core Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules_extra.html">Extras Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="common_return_values.html">Common Return Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="common_return_values.html#internal-use">Internal use</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="guides.html">Detailed Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="guide_aws.html">Amazon Web Services Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_azure.html">Getting Started with Azure</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_rax.html">Rackspace Cloud Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_gce.html">Google Cloud Platform Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_cloudstack.html">CloudStack Cloud Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_vagrant.html">Using Vagrant and Ansible</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_rolling_upgrade.html">Continuous Delivery and Rolling Upgrades</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_docker.html">Getting Started with Docker</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dev_guide/index.html">Developer Information</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dev_guide/index.html#ansible-developer-guide">Ansible Developer Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tower.html">Ansible Tower</a></li>
<li class="toctree-l1"><a class="reference internal" href="community.html">Community Information &amp; Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="community.html#ansible-users">Ansible Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="community.html#for-current-and-prospective-developers">For Current and Prospective Developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="community.html#other-topics">Other Topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="community.html#community-code-of-conduct">Community Code of Conduct</a></li>
<li class="toctree-l2"><a class="reference internal" href="community.html#contributors-license-agreement">Contributors License Agreement</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="galaxy.html">Ansible Galaxy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="galaxy.html#the-website">The Website</a></li>
<li class="toctree-l2"><a class="reference internal" href="galaxy.html#the-ansible-galaxy-command-line-tool">The ansible-galaxy command line tool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="test_strategies.html">Testing Strategies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#integrating-testing-with-ansible-playbooks">Integrating Testing With Ansible Playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#the-right-level-of-testing">The Right Level of Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#check-mode-as-a-drift-test">Check Mode As A Drift Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#modules-that-are-useful-for-testing">Modules That Are Useful for Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#testing-lifecycle">Testing Lifecycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#integrating-testing-with-rolling-updates">Integrating Testing With Rolling Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#achieving-continuous-deployment">Achieving Continuous Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-can-i-set-the-path-or-any-other-environment-variable-for-a-task-or-entire-playbook">How can I set the PATH or any other environment variable for a task or entire playbook?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-handle-different-machines-needing-different-user-accounts-or-ports-to-log-in-with">How do I handle different machines needing different user accounts or ports to log in with?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-get-ansible-to-reuse-connections-enable-kerberized-ssh-or-have-ansible-pay-attention-to-my-local-ssh-config-file">How do I get ansible to reuse connections, enable Kerberized SSH, or have Ansible pay attention to my local SSH config file?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-configure-a-jump-host-to-access-servers-that-i-have-no-direct-access-to">How do I configure a jump host to access servers that I have no direct access to?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-speed-up-management-inside-ec2">How do I speed up management inside EC2?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-handle-python-pathing-not-having-a-python-2-x-in-usr-bin-python-on-a-remote-machine">How do I handle python pathing not having a Python 2.X in /usr/bin/python on a remote machine?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#what-is-the-best-way-to-make-content-reusable-redistributable">What is the best way to make content reusable/redistributable?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#where-does-the-configuration-file-live-and-what-can-i-configure-in-it">Where does the configuration file live and what can I configure in it?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-disable-cowsay">How do I disable cowsay?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-see-a-list-of-all-of-the-ansible-variables">How do I see a list of all of the ansible_ variables?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-see-all-the-inventory-vars-defined-for-my-host">How do I see all the inventory vars defined for my host?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-loop-over-a-list-of-hosts-in-a-group-inside-of-a-template">How do I loop over a list of hosts in a group, inside of a template?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-access-a-variable-name-programmatically">How do I access a variable name programmatically?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-access-a-variable-of-the-first-host-in-a-group">How do I access a variable of the first host in a group?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-copy-files-recursively-onto-a-target-host">How do I copy files recursively onto a target host?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-access-shell-environment-variables">How do I access shell environment variables?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-generate-crypted-passwords-for-the-user-module">How do I generate crypted passwords for the user module?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#can-i-get-training-on-ansible-or-find-commercial-support">Can I get training on Ansible or find commercial support?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#is-there-a-web-interface-rest-api-etc">Is there a web interface / REST API / etc?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-submit-a-change-to-the-documentation">How do I submit a change to the documentation?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-keep-secret-data-in-my-playbook">How do I keep secret data in my playbook?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#when-should-i-use-also-how-to-interpolate-variables-or-dynamic-variable-names">When should I use {{ }}? Also, how to interpolate variables or dynamic variable names</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#i-don-t-see-my-question-here">I don&#8217;t see my question here</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="YAMLSyntax.html">YAML Syntax</a><ul>
<li class="toctree-l2"><a class="reference internal" href="YAMLSyntax.html#yaml-basics">YAML Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="YAMLSyntax.html#gotchas">Gotchas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="porting_guide_2.0.html">Porting Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#playbook">Playbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#deprecated">Deprecated</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#other-caveats">Other caveats</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="porting_guide_2.0.html#porting-plugins">Porting plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#lookup-plugins">Lookup plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#connection-plugins">Connection plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#action-plugins">Action plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#callback-plugins">Callback plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#id1">Connection plugins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="porting_guide_2.0.html#hybrid-plugins">Hybrid plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#id2">Lookup plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#id3">Connection plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#id4">Action plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#id5">Callback plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#id6">Connection plugins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="porting_guide_2.0.html#porting-custom-scripts">Porting custom scripts</a></li>
</ul>

        

<!-- changeable widget -->
<center>
<br/>
<a href="http://www.ansible.com/docs-left?utm_source=docs">
    <img style="border-width:0px;" src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-left-rail.png" />
</a>
</center>


      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="/">Ansible Documentation</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">

          <!-- Banner ads -->
          <div class="DocSiteBanner">
            <a class="DocSiteBanner-imgWrapper"
                href="http://www.ansible.com/docs-top?utm_source=docs">
                <img src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-top-left.png">
            </a>
            <a class="DocSiteBanner-imgWrapper"
                href="http://www.ansible.com/docs-top?utm_source=docs">
                <img src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-top-right.png">
            </a>
        </div>

          <ul class="wy-breadcrumbs">
  <li><a href="index.html">Docs</a> &raquo;</li>
  <li><a href="">Playbook Roles and Include Statements</a></li>
  
    <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/ansible/ansible/blob/devel/docsite/rst/playbooks_roles.rst" class="icon icon-github"> Edit on GitHub</a>
    </li>
  
</ul>
<hr/>

          <div id="page-content">
          
  <div class="section" id="playbook-roles-and-include-statements">
<h1><a class="toc-backref" href="#id3">Playbook Roles and Include Statements</a><a class="headerlink" href="#playbook-roles-and-include-statements" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="topics">
<p class="topic-title first">Topics</p>
<ul class="simple">
<li><a class="reference internal" href="#playbook-roles-and-include-statements" id="id3">Playbook Roles and Include Statements</a><ul>
<li><a class="reference internal" href="#introduction" id="id4">Introduction</a></li>
<li><a class="reference internal" href="#task-include-files-and-encouraging-reuse" id="id5">Task Include Files And Encouraging Reuse</a></li>
<li><a class="reference internal" href="#dynamic-versus-static-includes" id="id6">Dynamic versus Static Includes</a></li>
<li><a class="reference internal" href="#roles" id="id7">Roles</a></li>
<li><a class="reference internal" href="#role-default-variables" id="id8">Role Default Variables</a></li>
<li><a class="reference internal" href="#role-dependencies" id="id9">Role Dependencies</a></li>
<li><a class="reference internal" href="#embedding-modules-and-plugins-in-roles" id="id10">Embedding Modules and Plugins In Roles</a></li>
<li><a class="reference internal" href="#ansible-galaxy" id="id11">Ansible Galaxy</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id4">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>While it is possible to write a playbook in one very large file (and you might start out learning playbooks this way),
eventually you&#8217;ll want to reuse files and start to organize things.</p>
<p>At a basic level, including task files allows you to break up bits of
configuration policy into smaller files.  Task includes pull in tasks from other
files.  Since handlers are tasks too, you can also include handler files from
the &#8216;handler&#8217; section.</p>
<p>See <a class="reference internal" href="playbooks.html"><em>Playbooks</em></a> if you need a review of these concepts.</p>
<p>Playbooks can also include plays from other playbook files.  When that is done, the plays will be inserted into the playbook to form
a longer list of plays.</p>
<p>When you start to think about it &#8211; tasks, handlers, variables, and so on &#8211; begin to form larger concepts.  You start to think about modeling
what something is, rather than how to make something look like something.  It&#8217;s no longer &#8220;apply this handful of THINGS to these hosts&#8221;, you say &#8220;these hosts are dbservers&#8221; or &#8220;these hosts are webservers&#8221;.  In programming, we might call that &#8220;encapsulating&#8221; how things work.  For instance,
you can drive a car without knowing how the engine works.</p>
<p>Roles in Ansible build on the idea of include files and combine them to form clean, reusable abstractions &#8211; they allow you to focus
more on the big picture and only dive down into the details when needed.</p>
<p>We&#8217;ll start with understanding includes so roles make more sense, but our ultimate goal should be understanding roles &#8211; roles
are great and you should use them every time you write playbooks.</p>
<p>See the <a class="reference external" href="https://github.com/ansible/ansible-examples">ansible-examples</a> repository on GitHub for lots of examples of all of this
put together.  You may wish to have this open in a separate tab as you dive in.</p>
</div>
<div class="section" id="task-include-files-and-encouraging-reuse">
<h2><a class="toc-backref" href="#id5">Task Include Files And Encouraging Reuse</a><a class="headerlink" href="#task-include-files-and-encouraging-reuse" title="Permalink to this headline">¶</a></h2>
<p>Suppose you want to reuse lists of tasks between plays or playbooks.  You can use
include files to do this.  Use of included task lists is a great way to define a role
that system is going to fulfill.  Remember, the goal of a play in a playbook is to map
a group of systems into multiple roles.  Let&#8217;s see what this looks like...</p>
<p>A task include file simply contains a flat list of tasks, like so:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="c1"># possibly saved as tasks/foo.yml</span>

<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">placeholder foo</span>
  <span class="l l-Scalar l-Scalar-Plain">command</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/bin/foo</span>

<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">placeholder bar</span>
  <span class="l l-Scalar l-Scalar-Plain">command</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/bin/bar</span>
</pre></div>
</div>
<p>Include directives look like this, and can be mixed in with regular tasks in a playbook:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>

  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">include</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">tasks/foo.yml</span>
</pre></div>
</div>
<p>You can also pass variables into includes.  We call this a &#8216;parameterized include&#8217;.</p>
<p>For instance, to deploy to multiple wordpress instances, I could
encapsulate all of my wordpress tasks in a single wordpress.yml file, and use
it like so:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">include</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">wordpress.yml wp_user=timmy</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">include</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">wordpress.yml wp_user=alice</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">include</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">wordpress.yml wp_user=bob</span>
</pre></div>
</div>
<p>Starting in 1.0, variables can also be passed to include files using an alternative syntax,
which also supports structured variables:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>

  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">include</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">wordpress.yml</span>
    <span class="l l-Scalar l-Scalar-Plain">vars</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">wp_user</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">timmy</span>
        <span class="l l-Scalar l-Scalar-Plain">ssh_keys</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">keys/one.txt</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">keys/two.txt</span>
</pre></div>
</div>
<p>Using either syntax, variables passed in can then be used in the included files.  We&#8217;ll cover them in <a class="reference internal" href="playbooks_variables.html"><em>Variables</em></a>.
You can reference them like this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">{{</span> <span class="nv">wp_user</span> <span class="p p-Indicator">}}</span>
</pre></div>
</div>
<p>(In addition to the explicitly passed-in parameters, all variables from
the vars section are also available for use here as well.)</p>
<p>Playbooks can include other playbooks too, but that&#8217;s mentioned in a later section.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As of 1.0, task include statements can be used at arbitrary depth.
They were previously limited to a single level, so task includes
could not include other files containing task includes.</p>
</div>
<p>Includes can also be used in the &#8216;handlers&#8217; section, for instance, if you
want to define how to restart apache, you only have to do that once for all
of your playbooks.  You might make a handlers.yml that looks like:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="c1"># this might be in a file like handlers/handlers.yml</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">restart apache</span>
  <span class="l l-Scalar l-Scalar-Plain">service</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">name=apache state=restarted</span>
</pre></div>
</div>
<p>And in your main playbook file, just include it like so, at the bottom
of a play:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">handlers</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">include</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">handlers/handlers.yml</span>
</pre></div>
</div>
<p>You can mix in includes along with your regular non-included tasks and handlers.</p>
<p>Includes can also be used to import one playbook file into another. This allows
you to define a top-level playbook that is composed of other playbooks.</p>
<p>For example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">this is a play at the top level of a file</span>
  <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">all</span>
  <span class="l l-Scalar l-Scalar-Plain">remote_user</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>

  <span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>

  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">say hi</span>
    <span class="l l-Scalar l-Scalar-Plain">tags</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
    <span class="l l-Scalar l-Scalar-Plain">shell</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">echo &quot;hi...&quot;</span>

<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">include</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">load_balancers.yml</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">include</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers.yml</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">include</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dbservers.yml</span>
</pre></div>
</div>
<p>Note that you cannot do variable substitution when including one playbook
inside another.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can not conditionally pass the location to an include file,
like you can with &#8216;vars_files&#8217;.  If you find yourself needing to do
this, consider how you can restructure your playbook to be more
class/role oriented.  This is to say you cannot use a &#8216;fact&#8217; to
decide what include file to use.  All hosts contained within the
play are going to get the same tasks.  (&#8216;<em>when</em>&#8216; provides some
ability for hosts to conditionally skip tasks).</p>
</div>
</div>
<div class="section" id="dynamic-versus-static-includes">
<span id="dynamic-static"></span><h2><a class="toc-backref" href="#id6">Dynamic versus Static Includes</a><a class="headerlink" href="#dynamic-versus-static-includes" title="Permalink to this headline">¶</a></h2>
<p>Ansible 2.0 changes how include tasks are processed. In previous versions of Ansible, includes acted as a pre-processor statement and were read during playbook parsing time. This created problems with things like inventory variables (like group and host vars, which are not available during
the parsing time) were used in the included file name.</p>
<p>Ansible 2.0 instead makes includes &#8220;dynamic&#8221;, meaning they are not evaluated until the include task is
reached during the play execution. This change allows the reintroduction of loops on include statements,
such as the following:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">include</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">foo.yml param={{item}}</span>
  <span class="l l-Scalar l-Scalar-Plain">with_items</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
</pre></div>
</div>
<p>It is also possible to use variables from any source with a dynamic include:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">include</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{inventory_hostname}}.yml&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When an include statement loads different tasks for different hosts,
the <code class="docutils literal"><span class="pre">linear</span></code> strategy keeps the hosts in lock-step by alternating
which hosts are executing tasks while doing a <code class="docutils literal"><span class="pre">noop</span></code> for all other
hosts. For example, if you had hostA, hostB and hostC with the above
example, hostA would execute all of the tasks in hostA.yml while hostB
and hostC waited. It is generally better to do the above with the
<code class="docutils literal"><span class="pre">free</span></code> strategy, which does not force hosts to execute in lock-step.</p>
</div>
<p>Dynamic includes introduced some other limitations due to the fact that the included
file is not read in until that task is reached during the execution of the play. When using dynamic includes,
it is important to keep these limitations in mind:</p>
<ul class="simple">
<li>You cannot use <code class="docutils literal"><span class="pre">notify</span></code> to trigger a handler name which comes from a dynamic include.</li>
<li>You cannot use <code class="docutils literal"><span class="pre">--start-at-task</span></code> to begin execution at a task inside a dynamic include.</li>
<li>Tags which only exist inside a dynamic include will not show up in &#8211;list-tags output.</li>
<li>Tasks which only exist inside a dynamic include will not show up in &#8211;list-tasks output.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In Ansible 1.9.x and earlier, an error would be raised if a tag name was
used with <code class="docutils literal"><span class="pre">--tags</span></code> or <code class="docutils literal"><span class="pre">--skip-tags</span></code>. This error was disabled in Ansible
2.0 to prevent incorrect failures with tags which only existed inside of
dynamic includes.</p>
</div>
<p>To work around these limitations, Ansible 2.1 introduces the <code class="docutils literal"><span class="pre">static</span></code> option for includes:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">include</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">foo.yml</span>
  <span class="l l-Scalar l-Scalar-Plain">static</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;yes|no|true|false&gt;</span>
</pre></div>
</div>
<p>By default in Ansible 2.1 and higher, includes are automatically treated as static rather than
dynamic when the include meets the following conditions:</p>
<ul class="simple">
<li>The include does not use any loops</li>
<li>The included file name does not use any variables</li>
<li>The <code class="docutils literal"><span class="pre">static</span></code> option is not explicitly disabled (ie. <code class="docutils literal"><span class="pre">static:</span> <span class="pre">no</span></code>)</li>
<li>The ansible.cfg options to force static includes (see below) are disabled</li>
</ul>
<p>Two options are available in the ansible.cfg configuration for static includes:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">task_includes_static</span></code> - forces all includes in tasks sections to be static.</li>
<li><code class="docutils literal"><span class="pre">handler_includes_static</span></code> - forces all includes in handlers sections to be static.</li>
</ul>
<p>These options allow users to force playbooks to behave exactly as they did in 1.9.x and before.</p>
</div>
<div class="section" id="roles">
<span id="id1"></span><h2><a class="toc-backref" href="#id7">Roles</a><a class="headerlink" href="#roles" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.2.</span></p>
</div>
<p>Now that you have learned about tasks and handlers, what is the best way to organize your playbooks?
The short answer is to use roles!  Roles are ways of automatically loading certain vars_files, tasks, and
handlers based on a known file structure.  Grouping content by roles also allows easy sharing of roles with other users.</p>
<p>Roles are just automation around &#8216;include&#8217; directives as described above, and really don&#8217;t contain much
additional magic beyond some improvements to search path handling for referenced files.  However, that can be a big thing!</p>
<p>Example project structure:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">site.yml</span>
<span class="l l-Scalar l-Scalar-Plain">webservers.yml</span>
<span class="l l-Scalar l-Scalar-Plain">fooservers.yml</span>
<span class="l l-Scalar l-Scalar-Plain">roles/</span>
   <span class="l l-Scalar l-Scalar-Plain">common/</span>
     <span class="l l-Scalar l-Scalar-Plain">files/</span>
     <span class="l l-Scalar l-Scalar-Plain">templates/</span>
     <span class="l l-Scalar l-Scalar-Plain">tasks/</span>
     <span class="l l-Scalar l-Scalar-Plain">handlers/</span>
     <span class="l l-Scalar l-Scalar-Plain">vars/</span>
     <span class="l l-Scalar l-Scalar-Plain">defaults/</span>
     <span class="l l-Scalar l-Scalar-Plain">meta/</span>
   <span class="l l-Scalar l-Scalar-Plain">webservers/</span>
     <span class="l l-Scalar l-Scalar-Plain">files/</span>
     <span class="l l-Scalar l-Scalar-Plain">templates/</span>
     <span class="l l-Scalar l-Scalar-Plain">tasks/</span>
     <span class="l l-Scalar l-Scalar-Plain">handlers/</span>
     <span class="l l-Scalar l-Scalar-Plain">vars/</span>
     <span class="l l-Scalar l-Scalar-Plain">defaults/</span>
     <span class="l l-Scalar l-Scalar-Plain">meta/</span>
</pre></div>
</div>
<p>In a playbook, it would look like this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="l l-Scalar l-Scalar-Plain">roles</span><span class="p p-Indicator">:</span>
     <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">common</span>
     <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
</pre></div>
</div>
<p>This designates the following behaviors, for each role &#8216;x&#8217;:</p>
<ul class="simple">
<li>If roles/x/tasks/main.yml exists, tasks listed therein will be added to the play</li>
<li>If roles/x/handlers/main.yml exists, handlers listed therein will be added to the play</li>
<li>If roles/x/vars/main.yml exists, variables listed therein will be added to the play</li>
<li>If roles/x/defaults/main.yml exists, variables listed therein will be added to the play</li>
<li>If roles/x/meta/main.yml exists, any role dependencies listed therein will be added to the list of roles (1.3 and later)</li>
<li>Any copy, script, template or include tasks (in the role) can reference files in roles/x/{files,templates,tasks}/ (dir depends on task) without having to path them relatively or absolutely</li>
</ul>
<p>In Ansible 1.4 and later you can configure a roles_path to search for roles.  Use this to check all of your common roles out to one location, and share
them easily between multiple playbook projects.  See <a class="reference internal" href="intro_configuration.html"><em>Configuration file</em></a> for details about how to set this up in ansible.cfg.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Role dependencies are discussed below.</p>
</div>
<p>If any files are not present, they are just ignored.  So it&#8217;s ok to not have a &#8216;vars/&#8217; subdirectory for the role,
for instance.</p>
<p>Note, you are still allowed to list tasks, vars_files, and handlers &#8220;loose&#8221; in playbooks without using roles,
but roles are a good organizational feature and are highly recommended.  If there are loose things in the playbook,
the roles are evaluated first.</p>
<p>Also, should you wish to parameterize roles, by adding variables, you can do so, like this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="l l-Scalar l-Scalar-Plain">roles</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">common</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">role</span><span class="p p-Indicator">:</span> <span class="nv">foo_app_instance</span><span class="p p-Indicator">,</span> <span class="nv">dir</span><span class="p p-Indicator">:</span> <span class="s">&#39;/opt/a&#39;</span><span class="p p-Indicator">,</span>  <span class="nv">app_port</span><span class="p p-Indicator">:</span> <span class="nv">5000</span> <span class="p p-Indicator">}</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">role</span><span class="p p-Indicator">:</span> <span class="nv">foo_app_instance</span><span class="p p-Indicator">,</span> <span class="nv">dir</span><span class="p p-Indicator">:</span> <span class="s">&#39;/opt/b&#39;</span><span class="p p-Indicator">,</span>  <span class="nv">app_port</span><span class="p p-Indicator">:</span> <span class="nv">5001</span> <span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>While it&#8217;s probably not something you should do often, you can also conditionally apply roles like so:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="l l-Scalar l-Scalar-Plain">roles</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">role</span><span class="p p-Indicator">:</span> <span class="nv">some_role</span><span class="p p-Indicator">,</span> <span class="nv">when</span><span class="p p-Indicator">:</span> <span class="s">&quot;ansible_os_family</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&#39;RedHat&#39;&quot;</span> <span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>This works by applying the conditional to every task in the role.  Conditionals are covered later on in
the documentation.</p>
<p>Finally, you may wish to assign tags to the roles you specify. You can do so inline:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="l l-Scalar l-Scalar-Plain">roles</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">role</span><span class="p p-Indicator">:</span> <span class="nv">foo</span><span class="p p-Indicator">,</span> <span class="nv">tags</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;bar&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;baz&quot;</span><span class="p p-Indicator">]</span> <span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>Note that this <em>tags all of the tasks in that role with the tags specified</em>, overriding any tags that are specified inside the role. If you find yourself building a role with lots of tags and you want to call subsets of the role at different times, you should consider just splitting that role into multiple roles.</p>
<p>If the play still has a &#8216;tasks&#8217; section, those tasks are executed after roles are applied.</p>
<p>If you want to define certain tasks to happen before AND after roles are applied, you can do this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>

  <span class="l l-Scalar l-Scalar-Plain">pre_tasks</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">shell</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">echo &#39;hello&#39;</span>

  <span class="l l-Scalar l-Scalar-Plain">roles</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">role</span><span class="p p-Indicator">:</span> <span class="nv">some_role</span> <span class="p p-Indicator">}</span>

  <span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">shell</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">echo &#39;still busy&#39;</span>

  <span class="l l-Scalar l-Scalar-Plain">post_tasks</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">shell</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">echo &#39;goodbye&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If using tags with tasks (described later as a means of only running part of a playbook),
be sure to also tag your pre_tasks and post_tasks and pass those along as well, especially if the pre
and post tasks are used for monitoring outage window control or load balancing.</p>
</div>
</div>
<div class="section" id="role-default-variables">
<h2><a class="toc-backref" href="#id8">Role Default Variables</a><a class="headerlink" href="#role-default-variables" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.3.</span></p>
</div>
<p>Role default variables allow you to set default variables for included or dependent roles (see below). To create
defaults, simply add a <cite>defaults/main.yml</cite> file in your role directory. These variables will have the lowest priority
of any variables available, and can be easily overridden by any other variable, including inventory variables.</p>
</div>
<div class="section" id="role-dependencies">
<h2><a class="toc-backref" href="#id9">Role Dependencies</a><a class="headerlink" href="#role-dependencies" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.3.</span></p>
</div>
<p>Role dependencies allow you to automatically pull in other roles when using a role. Role dependencies are stored in the
<cite>meta/main.yml</cite> file contained within the role directory. This file should contain
a list of roles and parameters to insert before the specified role, such as the following in an example
<cite>roles/myapp/meta/main.yml</cite>:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="l l-Scalar l-Scalar-Plain">dependencies</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">role</span><span class="p p-Indicator">:</span> <span class="nv">common</span><span class="p p-Indicator">,</span> <span class="nv">some_parameter</span><span class="p p-Indicator">:</span> <span class="nv">3</span> <span class="p p-Indicator">}</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">role</span><span class="p p-Indicator">:</span> <span class="nv">apache</span><span class="p p-Indicator">,</span> <span class="nv">apache_port</span><span class="p p-Indicator">:</span> <span class="nv">80</span> <span class="p p-Indicator">}</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">role</span><span class="p p-Indicator">:</span> <span class="nv">postgres</span><span class="p p-Indicator">,</span> <span class="nv">dbname</span><span class="p p-Indicator">:</span> <span class="nv">blarg</span><span class="p p-Indicator">,</span> <span class="nv">other_parameter</span><span class="p p-Indicator">:</span> <span class="nv">12</span> <span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>Role dependencies can also be specified as a full path, just like top level roles:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="l l-Scalar l-Scalar-Plain">dependencies</span><span class="p p-Indicator">:</span>
   <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">role</span><span class="p p-Indicator">:</span> <span class="s">&#39;/path/to/common/roles/foo&#39;</span><span class="p p-Indicator">,</span> <span class="nv">x</span><span class="p p-Indicator">:</span> <span class="nv">1</span> <span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>Role dependencies can also be installed from source control repos or tar files (via <cite>galaxy</cite>) using comma separated format of path, an optional version (tag, commit, branch etc) and optional friendly role name (an attempt is made to derive a role name from the repo name or archive filename). Both through the command line or via a requirements.yml passed to ansible-galaxy.</p>
<p>Roles dependencies are always executed before the role that includes them, and are recursive. By default,
roles can also only be added as a dependency once - if another role also lists it as a dependency it will
not be run again. This behavior can be overridden by adding <cite>allow_duplicates: yes</cite> to the <cite>meta/main.yml</cite> file.
For example, a role named &#8216;car&#8217; could add a role named &#8216;wheel&#8217; to its dependencies as follows:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="l l-Scalar l-Scalar-Plain">dependencies</span><span class="p p-Indicator">:</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">role</span><span class="p p-Indicator">:</span> <span class="nv">wheel</span><span class="p p-Indicator">,</span> <span class="nv">n</span><span class="p p-Indicator">:</span> <span class="nv">1</span> <span class="p p-Indicator">}</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">role</span><span class="p p-Indicator">:</span> <span class="nv">wheel</span><span class="p p-Indicator">,</span> <span class="nv">n</span><span class="p p-Indicator">:</span> <span class="nv">2</span> <span class="p p-Indicator">}</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">role</span><span class="p p-Indicator">:</span> <span class="nv">wheel</span><span class="p p-Indicator">,</span> <span class="nv">n</span><span class="p p-Indicator">:</span> <span class="nv">3</span> <span class="p p-Indicator">}</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">role</span><span class="p p-Indicator">:</span> <span class="nv">wheel</span><span class="p p-Indicator">,</span> <span class="nv">n</span><span class="p p-Indicator">:</span> <span class="nv">4</span> <span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>And the <cite>meta/main.yml</cite> for wheel contained the following:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="l l-Scalar l-Scalar-Plain">allow_duplicates</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="l l-Scalar l-Scalar-Plain">dependencies</span><span class="p p-Indicator">:</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">role</span><span class="p p-Indicator">:</span> <span class="nv">tire</span> <span class="p p-Indicator">}</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">role</span><span class="p p-Indicator">:</span> <span class="nv">brake</span> <span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>The resulting order of execution would be as follows:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">tire(n=1)</span>
<span class="l l-Scalar l-Scalar-Plain">brake(n=1)</span>
<span class="l l-Scalar l-Scalar-Plain">wheel(n=1)</span>
<span class="l l-Scalar l-Scalar-Plain">tire(n=2)</span>
<span class="l l-Scalar l-Scalar-Plain">brake(n=2)</span>
<span class="l l-Scalar l-Scalar-Plain">wheel(n=2)</span>
<span class="nn">...</span>
<span class="l l-Scalar l-Scalar-Plain">car</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Variable inheritance and scope are detailed in the <a class="reference internal" href="playbooks_variables.html"><em>Variables</em></a>.</p>
</div>
</div>
<div class="section" id="embedding-modules-and-plugins-in-roles">
<h2><a class="toc-backref" href="#id10">Embedding Modules and Plugins In Roles</a><a class="headerlink" href="#embedding-modules-and-plugins-in-roles" title="Permalink to this headline">¶</a></h2>
<p>This is an advanced topic that should not be relevant for most users.</p>
<p>If you write a custom module (see <a class="reference internal" href="developing_modules.html"><em>Developing Modules</em></a>) or a plugin (see <a class="reference internal" href="developing_plugins.html"><em>Developing Plugins</em></a>), you may wish to distribute it as part of a role.
Generally speaking, Ansible as a project is very interested in taking high-quality modules into ansible core for inclusion, so this shouldn&#8217;t be the norm, but it&#8217;s quite easy to do.</p>
<p>A good example for this is if you worked at a company called AcmeWidgets, and wrote an internal module that helped configure your internal software, and you wanted other
people in your organization to easily use this module &#8211; but you didn&#8217;t want to tell everyone how to configure their Ansible library path.</p>
<p>Alongside the &#8216;tasks&#8217; and &#8216;handlers&#8217; structure of a role, add a directory named &#8216;library&#8217;.  In this &#8216;library&#8217; directory, then include the module directly inside of it.</p>
<p>Assuming you had this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">roles/</span>
   <span class="l l-Scalar l-Scalar-Plain">my_custom_modules/</span>
       <span class="l l-Scalar l-Scalar-Plain">library/</span>
          <span class="l l-Scalar l-Scalar-Plain">module1</span>
          <span class="l l-Scalar l-Scalar-Plain">module2</span>
</pre></div>
</div>
<p>The module will be usable in the role itself, as well as any roles that are called <em>after</em> this role, as follows:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="l l-Scalar l-Scalar-Plain">roles</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">my_custom_modules</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">some_other_role_using_my_custom_modules</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">yet_another_role_using_my_custom_modules</span>
</pre></div>
</div>
<p>This can also be used, with some limitations, to modify modules in Ansible&#8217;s core distribution, such as to use development versions of modules before they are released
in production releases.  This is not always advisable as API signatures may change in core components, however, and is not always guaranteed to work.  It can be a handy
way of carrying a patch against a core module, however, should you have good reason for this.  Naturally the project prefers that contributions be directed back
to github whenever possible via a pull request.</p>
<p>The same mechanism can be used to embed and distribute plugins in a role, using the same schema. For example, for a filter plugin:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">roles/</span>
   <span class="l l-Scalar l-Scalar-Plain">my_custom_filter/</span>
       <span class="l l-Scalar l-Scalar-Plain">filter_plugins</span>
          <span class="l l-Scalar l-Scalar-Plain">filter1</span>
          <span class="l l-Scalar l-Scalar-Plain">filter2</span>
</pre></div>
</div>
<p>They can then be used in a template or a jinja template in any role called after &#8216;my_custom_filter&#8217;</p>
</div>
<div class="section" id="ansible-galaxy">
<h2><a class="toc-backref" href="#id11">Ansible Galaxy</a><a class="headerlink" href="#ansible-galaxy" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://galaxy.ansible.com">Ansible Galaxy</a> is a free site for finding, downloading, rating, and reviewing all kinds of community developed Ansible roles and can be a great way to get a jumpstart on your automation projects.</p>
<p>You can sign up with social auth, and the download client &#8216;ansible-galaxy&#8217; is included in Ansible 1.4.2 and later.</p>
<p>Read the &#8220;About&#8221; page on the Galaxy site for more information.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<dl class="last docutils">
<dt><a class="reference internal" href="galaxy.html"><em>Ansible Galaxy</em></a></dt>
<dd>How to share roles on galaxy, role management</dd>
<dt><a class="reference internal" href="YAMLSyntax.html"><em>YAML Syntax</em></a></dt>
<dd>Learn about YAML syntax</dd>
<dt><a class="reference internal" href="playbooks.html"><em>Playbooks</em></a></dt>
<dd>Review the basic Playbook language features</dd>
<dt><a class="reference internal" href="playbooks_best_practices.html"><em>Best Practices</em></a></dt>
<dd>Various tips about managing playbooks in the real world</dd>
<dt><a class="reference internal" href="playbooks_variables.html"><em>Variables</em></a></dt>
<dd>All about variables in playbooks</dd>
<dt><a class="reference internal" href="playbooks_conditionals.html"><em>Conditionals</em></a></dt>
<dd>Conditionals in playbooks</dd>
<dt><a class="reference internal" href="playbooks_loops.html"><em>Loops</em></a></dt>
<dd>Loops in playbooks</dd>
<dt><a class="reference internal" href="modules.html"><em>About Modules</em></a></dt>
<dd>Learn about available modules</dd>
<dt><a class="reference internal" href="developing_modules.html"><em>Developing Modules</em></a></dt>
<dd>Learn how to extend Ansible by writing your own modules</dd>
<dt><a class="reference external" href="https://github.com/ansible/ansible-examples">GitHub Ansible examples</a></dt>
<dd>Complete playbook files from the GitHub project source</dd>
<dt><a class="reference external" href="http://groups.google.com/group/ansible-project">Mailing List</a></dt>
<dd>Questions? Help? Ideas?  Stop by the list on Google Groups</dd>
</dl>
</div>
</div>
</div>


          </div>
          <div id="search-results"><gcse:searchresults-only></div>
          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="playbooks_variables.html" class="btn btn-neutral float-right" title="Variables"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="playbooks_intro.html" class="btn btn-neutral" title="Intro to Playbooks"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','yABGvz2N8PwcwBxyfzUc','2.0.0');
</script>

  <p>
  Copyright © 2016 Red Hat, Inc.
  <br>
    Last updated on Jan 20, 2017.
  </p>
<p>
Ansible docs are generated from <a href="https://github.com/ansible/ansible">GitHub sources</A> using <A HREF="http://sphinx-doc.org/">Sphinx</A> using a theme provided by <a href="http://readthedocs.org">Read the Docs</a>. 
</p>
</footer>
        </div>
      </div>

    </section>

  </div>
  


<!-- begin analytics -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "standard-page"]);
        (function(d,s,i,r) {
        if (d.getElementById(i)){return;}
        var n = d.createElement(s),e = document.getElementsByTagName(s)[0];
        n.id=i;n.src = '//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/330046.js';
        e.parentNode.insertBefore(n, e);
        })(document, "script", "hs-analytics",300000);
</script>
<!-- end analytics -->

</body>
</html>