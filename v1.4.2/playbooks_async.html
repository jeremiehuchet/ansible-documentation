<?php
require('../wp-blog-header.php');
get_header();
?>

<div class="row">
	<div class="container">
		<?php if (function_exists('bootstrapwp_breadcrumbs')) bootstrapwp_breadcrumbs(); ?>
	</div><!--/.container -->
</div><!--/.row -->








<div class="container doc-content">
<div class="row clear-both">
    <!-- BEGIN LEFT-SIDEBAR -->
    
<div id="left-sidebar" class="span3 sidebar">
    <div class="side-nav sidebar-block left-side-nav">
      <ul><li><a href="/docs/"><strong>Documentation Home</strong></a></li></ul>
        
                <ul>
<li><a class="reference internal" href="#">Asynchronous Actions and Polling</a></li>
</ul>

        
      <hr />
      <div class="qsButton pagination-centered" />
        <a href="/quickstart"><button class="btn btn-primary" type="button">Quick Start Video</button></a>
      </div>
    </div>
</div>

    <!-- END LEFT-SIDEBAR -->
     <!-- BEGIN ARTICLE CONTENT AREA -->
    <div class="span8 main-column two-columns-left">
        
  <div class="section" id="asynchronous-actions-and-polling">
<h1><a class="toc-backref" href="#id1">Asynchronous Actions and Polling</a><a class="headerlink" href="#asynchronous-actions-and-polling" title="Permalink to this headline">Â¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#asynchronous-actions-and-polling" id="id1">Asynchronous Actions and Polling</a></li>
</ul>
</div>
<p>By default tasks in playbooks block, meaning the connections stay open
until the task is done on each node.  This may not always be desirable, or you may
be running operations that take longer than the SSH timeout.</p>
<p>The easiest way to do this is
to kick them off all at once and then poll until they are done.</p>
<p>You will also want to use asynchronous mode on very long running
operations that might be subject to timeout.</p>
<p>To launch a task asynchronously, specify its maximum runtime
and how frequently you would like to poll for status.  The default
poll value is 10 seconds if you do not specify a value for <cite>poll</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>---
- hosts: all
  remote_user: root
  tasks:
  - name: simulate long running op (15 sec), wait for up to 45, poll every 5
    command: /bin/sleep 15
    async: 45
    poll: 5
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There is no default for the async time limit.  If you leave off the
&#8216;async&#8217; keyword, the task runs synchronously, which is Ansible&#8217;s
default.</p>
</div>
<p>Alternatively, if you do not need to wait on the task to complete, you may
&#8220;fire and forget&#8221; by specifying a poll value of 0:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>---
- hosts: all
  remote_user: root
  tasks:
  - name: simulate long running op, allow to run for 45, fire and forget
    command: /bin/sleep 15
    async: 45
    poll: 0
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You shouldn&#8217;t &#8220;fire and forget&#8221; with operations that require
exclusive locks, such as yum transactions, if you expect to run other
commands later in the playbook against those same resources.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Using a higher value for <code class="docutils literal"><span class="pre">--forks</span></code> will result in kicking off asynchronous
tasks even faster.  This also increases the efficiency of polling.</p>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<dl class="last docutils">
<dt><a class="reference internal" href="playbooks.html"><em>Intro to Playbooks</em></a></dt>
<dd>An introduction to playbooks</dd>
<dt><a class="reference external" href="http://groups.google.com/group/ansible-devel">User Mailing List</a></dt>
<dd>Have a question?  Stop by the google group!</dd>
<dt><a class="reference external" href="http://irc.freenode.net">irc.freenode.net</a></dt>
<dd>#ansible IRC chat channel</dd>
</dl>
</div>
</div>


    </div><!-- END ARTICLE CONTENT AREA -->
</div> <!-- class=row -->
</div> <!-- class=container -->

<?php get_footer('home'); ?>