<?php
require('../wp-blog-header.php');
get_header();
?>

<div class="row">
	<div class="container">
		<?php if (function_exists('bootstrapwp_breadcrumbs')) bootstrapwp_breadcrumbs(); ?>
	</div><!--/.container -->
</div><!--/.row -->








<div class="container doc-content">
<div class="row clear-both">
    <!-- BEGIN LEFT-SIDEBAR -->
    
<div id="left-sidebar" class="span3 sidebar">
    <div class="side-nav sidebar-block left-side-nav">
      <ul><li><a href="/docs/"><strong>Documentation Home</strong></a></li></ul>
        
                <ul>
<li><a class="reference internal" href="#">Developing Dynamic Inventory Sources</a><ul>
<li><a class="reference internal" href="#script-conventions">Script Conventions</a></li>
<li><a class="reference internal" href="#tuning-the-external-inventory-script">Tuning the External Inventory Script</a></li>
</ul>
</li>
</ul>

        
      <hr />
      <div class="qsButton pagination-centered" />
        <a href="/quickstart"><button class="btn btn-primary" type="button">Quick Start Video</button></a>
      </div>
    </div>
</div>

    <!-- END LEFT-SIDEBAR -->
     <!-- BEGIN ARTICLE CONTENT AREA -->
    <div class="span8 main-column two-columns-left">
        
  <div class="section" id="developing-dynamic-inventory-sources">
<h1><a class="toc-backref" href="#id1">Developing Dynamic Inventory Sources</a><a class="headerlink" href="#developing-dynamic-inventory-sources" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first"><cite>Table of contents</cite></p>
<ul class="simple">
<li><a class="reference internal" href="#developing-dynamic-inventory-sources" id="id1">Developing Dynamic Inventory Sources</a><ul>
<li><a class="reference internal" href="#script-conventions" id="id2">Script Conventions</a></li>
<li><a class="reference internal" href="#tuning-the-external-inventory-script" id="id3">Tuning the External Inventory Script</a></li>
</ul>
</li>
</ul>
</div>
<p>As described in <cite>intro_inventory_dynamic</cite>, ansible can pull inventory information from dynamic sources, including cloud sources.</p>
<p>How do we write a new one?</p>
<p>Simple!  We just create a script or program that can return JSON in the right format when fed the proper arguments.
You can do this in any language.</p>
<div class="section" id="script-conventions">
<span id="inventory-script-conventions"></span><h2><a class="toc-backref" href="#id2">Script Conventions</a><a class="headerlink" href="#script-conventions" title="Permalink to this headline">¶</a></h2>
<p>When the external node script is called with the single argument &#8216;&#8211;list&#8217;, the script must return a JSON hash/dictionary of all the groups to be managed. Each group&#8217;s value should be either a hash/dictionary containing a list of each host/IP, potential child groups, and potential group variables, or simply a list of host/IP addresses, like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;databases&quot;</span>   <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;hosts&quot;</span>   <span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;host1.example.com&quot;</span><span class="p">,</span> <span class="s2">&quot;host2.example.com&quot;</span> <span class="p">],</span>
        <span class="s2">&quot;vars&quot;</span>    <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;a&quot;</span>   <span class="p">:</span> <span class="n">true</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;webservers&quot;</span>  <span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;host2.example.com&quot;</span><span class="p">,</span> <span class="s2">&quot;host3.example.com&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;atlanta&quot;</span>     <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;hosts&quot;</span>   <span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;host1.example.com&quot;</span><span class="p">,</span> <span class="s2">&quot;host4.example.com&quot;</span><span class="p">,</span> <span class="s2">&quot;host5.example.com&quot;</span> <span class="p">],</span>
        <span class="s2">&quot;vars&quot;</span>    <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;b&quot;</span>   <span class="p">:</span> <span class="n">false</span>
        <span class="p">},</span>
        <span class="s2">&quot;children&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;marietta&quot;</span><span class="p">,</span> <span class="s2">&quot;5points&quot;</span> <span class="p">],</span>
    <span class="p">},</span>
    <span class="s2">&quot;marietta&quot;</span>    <span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;host6.example.com&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;5points&quot;</span>     <span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;host7.example.com&quot;</span> <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.0.</span></p>
</div>
<p>Before version 1.0, each group could only have a list of hostnames/IP addresses, like the webservers, marietta, and 5points groups above.</p>
<p>When called with the arguments &#8216;&#8211;host &lt;hostname&gt;&#8217; (where &lt;hostname&gt; is a host from above), the script must return either an empty JSON
hash/dictionary, or a hash/dictionary of variables to make available to templates and playbooks.  Returning variables is optional,
if the script does not wish to do this, returning an empty hash/dictionary is the way to go:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;favcolor&quot;</span>   <span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ntpserver&quot;</span>  <span class="p">:</span> <span class="s2">&quot;wolf.example.com&quot;</span><span class="p">,</span>
    <span class="s2">&quot;monitoring&quot;</span> <span class="p">:</span> <span class="s2">&quot;pack.example.com&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="tuning-the-external-inventory-script">
<span id="inventory-script-tuning"></span><h2><a class="toc-backref" href="#id3">Tuning the External Inventory Script</a><a class="headerlink" href="#tuning-the-external-inventory-script" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.3.</span></p>
</div>
<p>The stock inventory script system detailed above works for all versions of Ansible, but calling
&#8216;&#8211;host&#8217; for every host can be rather expensive,  especially if it involves expensive API calls to
a remote subsystem.  In Ansible
1.3 or later, if the inventory script returns a top level element called &#8220;_meta&#8221;, it is possible
to return all of the host variables in one inventory script call.  When this meta element contains
a value for &#8220;hostvars&#8221;, the inventory script will not be invoked with &#8220;&#8211;host&#8221; for each host.  This
results in a significant performance increase for large numbers of hosts, and also makes client
side caching easier to implement for the inventory script.</p>
<p>The data to be added to the top level JSON dictionary looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span> {

     # results of inventory script as above go here
     # ...

     &quot;_meta&quot; : {
        &quot;hostvars&quot; : {
           &quot;moocow.example.com&quot;     : { &quot;asdf&quot; : 1234 },
           &quot;llama.example.com&quot;      : { &quot;asdf&quot; : 5678 },
        }
     }

 }

:doc:`developing_api`
    Python API to Playbooks and Ad Hoc Task Execution
:doc:`developing_modules`
    How to develop modules
:doc:`developing_plugins`
    How to develop plugins
`AnsibleWorks AWX &lt;http://ansibleworks.com/ansibleworks-awx`_
    REST API endpoint and GUI for Ansible, syncs with dynamic inventory
`Development Mailing List &lt;http://groups.google.com/group/ansible-devel&gt;`_
    Mailing list for development topics
`irc.freenode.net &lt;http://irc.freenode.net&gt;`_
    #ansible IRC chat channel
</pre></div>
</div>
</div>
</div>


    </div><!-- END ARTICLE CONTENT AREA -->
</div> <!-- class=row -->
</div> <!-- class=container -->

<?php get_footer('home'); ?>