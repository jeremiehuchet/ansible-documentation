<?php
require('../wp-blog-header.php');
get_header();
?>

<div class="row">
	<div class="container">
		<?php if (function_exists('bootstrapwp_breadcrumbs')) bootstrapwp_breadcrumbs(); ?>
	</div><!--/.container -->
</div><!--/.row -->








<div class="container doc-content">
<div class="row clear-both">
    <!-- BEGIN LEFT-SIDEBAR -->
    
<div id="left-sidebar" class="span3 sidebar">
    <div class="side-nav sidebar-block left-side-nav">
      <ul><li><a href="/docs/"><strong>Documentation Home</strong></a></li></ul>
        
                <ul>
<li><a class="reference internal" href="#">Accelerated Mode</a><ul>
<li><a class="reference internal" href="#fireball-mode">Fireball Mode</a></li>
</ul>
</li>
</ul>

        
      <hr />
      <div class="qsButton pagination-centered" />
        <a href="/quickstart"><button class="btn btn-primary" type="button">Quick Start Video</button></a>
      </div>
    </div>
</div>

    <!-- END LEFT-SIDEBAR -->
     <!-- BEGIN ARTICLE CONTENT AREA -->
    <div class="span8 main-column two-columns-left">
        
  <div class="section" id="accelerated-mode">
<h1><a class="toc-backref" href="#id2">Accelerated Mode</a><a class="headerlink" href="#accelerated-mode" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#accelerated-mode" id="id2">Accelerated Mode</a><ul>
<li><a class="reference internal" href="#fireball-mode" id="id3">Fireball Mode</a></li>
</ul>
</li>
</ul>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.3.</span></p>
</div>
<p>While OpenSSH using the ControlPersist feature is quite fast and scalable, there is a certain small amount of overhead involved in
using SSH connections.  While many people will not encounter a need, if you are running on a platform that doesn&#8217;t have ControlPersist support (such as an EL6 control machine), you&#8217;ll probably be even more interested in tuning options.</p>
<p>Accelerate mode is there to help connections work faster, but still uses SSH for initial secure key exchange.  There is no
additional public key infrastructure to manage, and this does not require things like NTP or even DNS.</p>
<p>Accelerated mode can be anywhere from 2-6x faster than SSH with ControlPersist enabled, and 10x faster than paramiko.</p>
<p>Accelerated mode works by launching a temporary daemon over SSH. Once the daemon is running, Ansible will connect directly
to it via a socket connection. Ansible secures this communication by using a temporary AES key that is exchanged during
the SSH connection (this key is different for every host, and is also regenerated periodically).</p>
<p>By default, Ansible will use port 5099 for the accelerated connection, though this is configurable. Once running, the daemon will accept connections for 30 minutes, after which time it will terminate itself and need to be restarted over SSH.</p>
<p>Accelerated mode offers several improvements over the original fireball mode from which it was based:</p>
<ul class="simple">
<li>No bootstrapping is required, only a single line needs to be added to each play you wish to run in accelerated mode.</li>
<li>Support for sudo commands (see below for more details and caveats) is available.</li>
<li>There are fewer requirements. ZeroMQ is no longer required, nor are there any special packages beyond python-keyczar</li>
<li>python 2.5 or higher is required.</li>
</ul>
<p>In order to use accelerated mode, simply add <cite>accelerate: true</cite> to your play:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>---
- hosts: all
  accelerate: true
  tasks:
  - name: some task
    command: echo {{ item }}
    with_items:
    - foo
    - bar
    - baz
</pre></div>
</div>
<p>If you wish to change the port Ansible will use for the accelerated connection, just add the <cite>accelerated_port</cite> option:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>---
- hosts: all
  accelerate: true
  # default port is 5099
  accelerate_port: 10000
</pre></div>
</div>
<p>The <cite>accelerate_port</cite> option can also be specified in the environment variable ACCELERATE_PORT, or in your <cite>ansible.cfg</cite> configuration:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">accelerate</span><span class="p">]</span>
<span class="n">accelerate_port</span> <span class="o">=</span> <span class="mi">5099</span>
</pre></div>
</div>
<p>As noted above, accelerated mode also supports running tasks via sudo, however there are two important caveats:</p>
<ul class="simple">
<li>You must remove requiretty from your sudoers options.</li>
<li>Prompting for the sudo password is not yet supported, so the NOPASSWD option is required for sudo&#8217;ed commands.</li>
</ul>
<div class="section" id="fireball-mode">
<span id="id1"></span><h2><a class="toc-backref" href="#id3">Fireball Mode</a><a class="headerlink" href="#fireball-mode" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.8: </span>(deprecated as of 1.3)</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The following section has been deprecated as of Ansible 1.3 in favor of the accelerated mode described above. This
documentation is here for users who may still be using the original fireball connection method only, and should not
be used for any new deployments.</p>
</div>
<p>Ansible&#8217;s core connection types of &#8216;local&#8217;, &#8216;paramiko&#8217;, and &#8216;ssh&#8217; are augmented in version 0.8 and later by a new extra-fast
connection type called &#8216;fireball&#8217;.  It can only be used with playbooks and does require some additional setup
outside the lines of Ansible&#8217;s normal &#8220;no bootstrapping&#8221; philosophy.  You are not required to use fireball mode
to use Ansible, though some users may appreciate it.</p>
<p>Fireball mode works by launching a temporary 0mq daemon from SSH that by default lives for only 30 minutes before
shutting off.  Fireball mode, once running, uses temporary AES keys to encrypt a session, and requires direct
communication to given nodes on the configured port.  The default is 5099.  The fireball daemon runs as any user you
set it down as.  So it can run as you, root, or so on.  If multiple users are running Ansible as the same batch of hosts,
take care to use unique ports.</p>
<p>Fireball mode is roughly 10 times faster than paramiko for communicating with nodes and may be a good option
if you have a large number of hosts:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>---

# set up the fireball transport
- hosts: all
  gather_facts: no
  connection: ssh # or paramiko
  sudo: yes
  tasks:
      - action: fireball

# these operations will occur over the fireball transport
- hosts: all
  connection: fireball
  tasks:
      - shell: echo &quot;Hello {{ item }}&quot;
        with_items:
            - one
            - two
</pre></div>
</div>
<p>In order to use fireball mode, certain dependencies must be installed on both ends.   You can use this playbook as a basis for initial bootstrapping on
any platform.  You will also need gcc and zeromq-devel installed from your package manager, which you can of course also get Ansible to install:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>---
- hosts: all
  sudo: yes
  gather_facts: no
  connection: ssh
  tasks:
      - easy_install: name=pip
      - pip: name={{ item }} state=present
        with_items:
          - pyzmq
          - pyasn1
          - PyCrypto
          - python-keyczar
</pre></div>
</div>
<p>Fedora and EPEL also have Ansible RPM subpackages available for fireball-dependencies.</p>
<p>Also see the module documentation section.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<dl class="last docutils">
<dt><a class="reference internal" href="playbooks.html"><em>Intro to Playbooks</em></a></dt>
<dd>Introductory playbook information</dd>
<dt><a class="reference external" href="http://groups.google.com/group/ansible-devel">User Mailing List</a></dt>
<dd>Have a question?  Stop by the google group!</dd>
<dt><a class="reference external" href="http://irc.freenode.net">irc.freenode.net</a></dt>
<dd>#ansible IRC chat channel</dd>
</dl>
</div>
</div>
</div>


    </div><!-- END ARTICLE CONTENT AREA -->
</div> <!-- class=row -->
</div> <!-- class=container -->

<?php get_footer('home'); ?>